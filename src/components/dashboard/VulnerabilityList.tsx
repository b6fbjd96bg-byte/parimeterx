import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { AlertTriangle, ChevronDown, ChevronUp, ExternalLink, Shield, Bug } from 'lucide-react';

interface Vulnerability {
  id: string;
  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
  title: string;
  description: string;
  location: string;
  cve_id?: string;
  cvss_score?: number;
}

const VulnerabilityList = () => {
  const [expandedId, setExpandedId] = useState<string | null>(null);

  // Demo vulnerabilities for visual display
  const vulnerabilities: Vulnerability[] = [
    {
      id: '1',
      severity: 'critical',
      title: 'SQL Injection in Login Form',
      description: 'The login form is vulnerable to SQL injection attacks. An attacker could bypass authentication or extract sensitive data from the database.',
      location: '/api/auth/login',
      cve_id: 'CVE-2024-1234',
      cvss_score: 9.8,
    },
    {
      id: '2',
      severity: 'high',
      title: 'Cross-Site Scripting (XSS)',
      description: 'Reflected XSS vulnerability found in the search parameter. User input is not properly sanitized before being rendered.',
      location: '/search?q=',
      cve_id: 'CVE-2024-5678',
      cvss_score: 7.5,
    },
    {
      id: '3',
      severity: 'medium',
      title: 'Insecure Direct Object Reference',
      description: 'User can access other users\' data by modifying the ID parameter in the URL.',
      location: '/api/users/:id',
      cvss_score: 6.5,
    },
    {
      id: '4',
      severity: 'low',
      title: 'Missing Security Headers',
      description: 'Several security headers are missing including X-Frame-Options, X-Content-Type-Options, and Content-Security-Policy.',
      location: 'All endpoints',
      cvss_score: 3.7,
    },
    {
      id: '5',
      severity: 'info',
      title: 'Server Version Disclosure',
      description: 'The server response headers reveal the exact version of the web server software.',
      location: 'Server headers',
      cvss_score: 2.0,
    },
  ];

  const getSeverityColor = (severity: string) => {
    const colors: Record<string, string> = {
      critical: 'bg-red-500/20 text-red-500 border-red-500/30',
      high: 'bg-orange-500/20 text-orange-500 border-orange-500/30',
      medium: 'bg-yellow-500/20 text-yellow-500 border-yellow-500/30',
      low: 'bg-green-500/20 text-green-500 border-green-500/30',
      info: 'bg-blue-500/20 text-blue-500 border-blue-500/30',
    };
    return colors[severity] || colors.info;
  };

  const getSeverityIcon = (severity: string) => {
    if (severity === 'critical' || severity === 'high') {
      return <AlertTriangle className="w-4 h-4" />;
    }
    return <Bug className="w-4 h-4" />;
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Shield className="w-5 h-5 text-primary" />
          Detected Vulnerabilities
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {vulnerabilities.map((vuln, index) => (
            <div
              key={vuln.id}
              className="border border-border rounded-lg overflow-hidden animate-fade-in"
              style={{ animationDelay: `${index * 100}ms` }}
            >
              <button
                onClick={() => setExpandedId(expandedId === vuln.id ? null : vuln.id)}
                className="w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors"
              >
                <div className="flex items-center gap-3">
                  <Badge className={`${getSeverityColor(vuln.severity)} border`}>
                    {getSeverityIcon(vuln.severity)}
                    <span className="ml-1 uppercase">{vuln.severity}</span>
                  </Badge>
                  <div className="text-left">
                    <p className="font-medium">{vuln.title}</p>
                    <p className="text-xs text-muted-foreground">{vuln.location}</p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  {vuln.cvss_score && (
                    <span className="text-sm font-mono text-muted-foreground">
                      CVSS: {vuln.cvss_score}
                    </span>
                  )}
                  {expandedId === vuln.id ? (
                    <ChevronUp className="w-4 h-4" />
                  ) : (
                    <ChevronDown className="w-4 h-4" />
                  )}
                </div>
              </button>

              {expandedId === vuln.id && (
                <div className="px-4 pb-4 border-t border-border bg-muted/30 animate-fade-in">
                  <div className="pt-4 space-y-3">
                    <div>
                      <p className="text-sm font-medium mb-1">Description</p>
                      <p className="text-sm text-muted-foreground">{vuln.description}</p>
                    </div>
                    {vuln.cve_id && (
                      <div className="flex items-center gap-2">
                        <Badge variant="outline">{vuln.cve_id}</Badge>
                        <Button variant="ghost" size="sm" className="h-6 px-2">
                          <ExternalLink className="w-3 h-3 mr-1" />
                          View Details
                        </Button>
                      </div>
                    )}
                    <div className="flex gap-2">
                      <Button size="sm" variant="outline">Mark as Fixed</Button>
                      <Button size="sm" variant="outline">Add Note</Button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  );
};

export default VulnerabilityList;
